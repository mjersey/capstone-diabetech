<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - My Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
</head>
<body>
  <!-- Header -->
  <header class="header">
      <div class="header-left">
          <div class="logo" id="headerLogo">
              <img src="{{ url_for('static', filename='assets/diabetech-logo.png') }}" alt="Diabetech">
              <span>diabetech</span>
          </div>
          <h1 class="page-title" id="pageTitle">Settings - My Profile</h1>
      </div>
      
      <div class="header-right">
          <div class="search-container">
              <span class="material-symbols-outlined search-icon">search</span>
              <input type="text" placeholder="Search ..." class="search-input">
          </div>
          <button class="notification-btn">
              <span class="material-symbols-outlined">notifications</span>
          </button>
          <div class="user-profile" id="userProfile">
              <img src="/placeholder.svg?height=40&width=40" alt="" class="user-avatar">
          </div>
      </div>
  </header>

  <div class="main-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
          <nav class="sidebar-nav">
              <a href="/dashboard" class="nav-item">
                  <span class="material-symbols-outlined">dashboard</span>
                  <span class="nav-text">Dashboard</span>
              </a>
              <a href="/prescription" class="nav-item">
                  <span class="material-symbols-outlined">description</span>
                  <span class="nav-text">Prescription</span>
              </a>
              <a href="/patients" class="nav-item">
                  <span class="material-symbols-outlined">person</span>
                  <span class="nav-text">Patients</span>
              </a>
              <a href="/analytics" class="nav-item">
                  <span class="material-symbols-outlined">monitoring</span>
                  <span class="nav-text">Analytics</span>
              </a>
              <a href="/insights" class="nav-item">
                  <span class="material-symbols-outlined">lightbulb</span>
                  <span class="nav-text">Insights</span>
              </a>
              <a href="/settings" class="nav-item active">
                  <span class="material-symbols-outlined">settings</span>
                  <span class="nav-text">Settings</span>
              </a>
          </nav>
          
          <div class="sidebar-bottom">
              <div class="nav-item" id="signOutBtn">
                  <span class="material-symbols-outlined">logout</span>
                  <span class="nav-text">Sign Out</span>
              </div>
          </div>
      </aside>

      <!-- Main Content -->
      <main class="content settings-content">
          <div class="settings-grid">
              <!-- Left Settings Navigation -->
              <div class="settings-nav">
                  <div class="settings-nav-item active">My Profile</div>
                  <div class="settings-nav-item">Account Security</div>
                  <div class="settings-nav-item">Clinical Settings</div>
                  <div class="settings-nav-item">E-Prescription</div>
                  <div class="settings-nav-item">Notification</div>
                  <div class="settings-nav-item">Support</div>
              </div>

              <!-- Right Settings Details -->
              <div class="settings-details">
                  <!-- Personal Information Section -->
                  <div class="settings-card" id="personalInfoSection">
                      <div class="card-header">
                          <h2>Personal Information</h2>
                      </div>
                      <div class="card-body personal-info-body">
                          <div class="profile-avatar-section">
                              <div class="profile-avatar-container" id="profileAvatarContainer">
                                  <img src="/placeholder.svg?height=100&width=100" alt="Profile" class="profile-avatar-large" id="profileAvatar">
                                  <div class="avatar-overlay">
                                      <span class="material-symbols-outlined">photo_camera</span>
                                  </div>
                                  <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
                              </div>
                          </div>
                          <div class="profile-form">
                              <div class="form-row">
                                  <div class="form-group">
                                      <label for="firstName">First Name</label>
                                      <input type="text" id="firstName" name="firstName" value="{{ user.first_name }}" readonly>
                                  </div>
                                  <div class="form-group">
                                      <label for="lastName">Last Name</label>
                                      <input type="text" id="lastName" name="lastName" value="{{ user.last_name }}" readonly>
                                  </div>
                              </div>
                              
                              <div class="form-group">
                                  <label for="emailAddress">Email Address</label>
                                  <input type="email" id="emailAddress" name="emailAddress" value="{{ user.email }}" readonly>
                              </div>
                              
                              <div class="form-row">
                                  <div class="form-group">
                                      <label for="specialization">Specialization</label>
                                      <input type="text" id="specialization" name="specialization" value="{{ user.specialization }}" readonly>
                                  </div>
                                  <div class="form-group">
                                      <label for="medicalLicense">Medical License #</label>
                                      <input type="text" id="medicalLicense" name="medicalLicense" value="{{ user.medical_license }}" readonly>
                                  </div>
                              </div>
                          </div>
                          <div class="profile-actions">
                              <button class="btn-edit-personal-info" id="editPersonalInfoBtn">Edit</button>
                              <button class="btn-save-personal-info" id="savePersonalInfoBtn" style="display: none;">Save Changes</button>
                          </div>
                      </div>
                  </div>

                  <!-- Password Section -->
                  <div class="settings-card" id="passwordSection">
                      <div class="card-header">
                          <h2>Password</h2>
                          <p>Update your password to keep your account secure.</p>
                      </div>
                      <div class="card-body password-section-body">
                          <div class="password-form">
                              <div class="form-group">
                                  <label for="currentPassword">Current Password</label>
                                  <input type="password" id="currentPassword" name="currentPassword" placeholder="••••••••••••••••••••••••" readonly>
                              </div>
                              <div class="form-group">
                                  <label for="newPassword">New Password</label>
                                  <input type="password" id="newPassword" name="newPassword" placeholder="Enter new password" disabled>
                              </div>
                              <div class="form-group">
                                  <label for="confirmNewPassword">Confirm Password</label>
                                  <input type="password" id="confirmNewPassword" name="confirmNewPassword" placeholder="Confirm new password" disabled>
                              </div>
                              <div class="password-actions">
                                  <button class="btn-change-password" id="changePasswordBtn">Change</button>
                                  <button class="btn-save-password" id="savePasswordBtn" style="display: none;">Save Password</button>
                              </div>
                          </div>
                          <div class="password-rules">
                              <h3>Rules for passwords</h3>
                              <p>For your protection, we recommend using a strong password that:</p>
                              <ul>
                                  <li>Has at least 8 characters</li>
                                  <li>Includes a mix of uppercase and lowercase letters</li>
                                  <li>Contains numbers and special characters (e.g., @, #, $)</li>
                                  <li>Avoids using easily guessed words like "password" or your name</li>
                              </ul>
                          </div>
                      </div>
                  </div>

                  <!-- Delete Account Section -->
                  <div class="settings-card delete-account-card" id="deleteAccountSection">
                      <div class="card-header">
                          <h2>Delete Account?</h2>
                          <p>Deleting your DIABETECH account will permanently erase all your personal data, health records, and system access. This action is irreversible and cannot be undone. Please proceed only if you're sure you no longer need your account.</p>
                      </div>
                      <div class="card-body">
                          <button class="btn-delete-account" id="deleteAccountBtn">Delete Account</button>
                      </div>
                  </div>

                  <!-- Account Security Section -->
                  <div class="settings-card" id="accountSecuritySection" style="display: none;">
                      <div class="card-header">
                          <h2>Secure Your Account</h2>
                          <p>Monitoring login activities and managing your active sessions.</p>
                      </div>
                      <div class="card-body account-security-body">
                          <!-- Email Verification -->
                          <div class="security-item">
                              <div class="security-item-content">
                                  <h3>Email Verification</h3>
                                  <div class="email-verification-info">
                                      <span class="verified-email">{{ user.email }}</span>
                                      <span class="verification-badge verified">Verified</span>
                                  </div>
                              </div>
                              <button class="btn-secondary" id="resendEmailBtn">Resend Email Verification</button>
                          </div>

                          <!-- Two-Factor Authentication -->
                          <div class="security-item">
                              <div class="security-item-content">
                                  <h3>Two-Factor Authentication (2FA)</h3>
                                  <div class="tfa-info">
                                      <span class="tfa-badge enabled">Enabled</span>
                                      <p class="tfa-description">Add an extra layer of security by requiring a verification code during login, sent to your email.</p>
                                  </div>
                              </div>
                              <button class="btn-secondary" id="disableTfaBtn">Disable</button>
                          </div>

                          <!-- Recent Login Activity -->
                          <div class="security-item login-activity">
                              <div class="security-item-header">
                                  <div class="security-item-content">
                                      <h3>Recent Login Activity</h3>
                                      <p class="activity-description">Manage all active sessions to monitor access and protect your account.</p>
                                  </div>
                                  <button class="btn-secondary" id="signOutAllBtn">Sign Out All Devices</button>
                              </div>
                              
                              <div class="login-sessions">
                                  <!-- Current Session -->
                                  <div class="session-item current-session">
                                      <div class="session-icon">
                                          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/chrome/chrome-original.svg" alt="Chrome" class="browser-icon">
                                      </div>
                                      <div class="session-info">
                                          <div class="session-browser">Chrome</div>
                                          <div class="session-details">
                                              <span class="session-status current">Current Session</span>
                                              <span class="session-location">• Quezon City, PH</span>
                                          </div>
                                      </div>
                                      <button class="btn-sign-out current" disabled>Sign Out</button>
                                  </div>

                                  <!-- Other Sessions Header -->
                                  <div class="other-sessions-header">
                                      <span class="sessions-count">2 other sessions</span>
                                  </div>

                                  <!-- Other Sessions -->
                                  <div class="session-item">
                                      <div class="session-icon">
                                          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/safari/safari-original.svg" alt="Safari" class="browser-icon">
                                      </div>
                                      <div class="session-info">
                                          <div class="session-browser">Safari</div>
                                          <div class="session-details">
                                              <span class="session-time">Last 3 days ago</span>
                                              <span class="session-location">• Manila, PH</span>
                                          </div>
                                      </div>
                                      <button class="btn-sign-out" data-session="safari-session">Sign Out</button>
                                  </div>

                                  <div class="session-item">
                                      <div class="session-icon">
                                          <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/chrome/chrome-original.svg" alt="Chrome" class="browser-icon">
                                      </div>
                                      <div class="session-info">
                                          <div class="session-browser">Chrome</div>
                                          <div class="session-details">
                                              <span class="session-time">Last 2 months ago</span>
                                              <span class="session-location">• Quezon City, PH</span>
                                          </div>
                                      </div>
                                      <button class="btn-sign-out" data-session="chrome-session-2">Sign Out</button>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </main>
  </div>

  <!-- Sign Out Modal (reused from dashboard) -->
  <div class="modal-overlay" id="modalOverlay">
      <div class="modal">
          <div class="modal-content">
              <h3>Sign Out</h3>
              <p>Are you sure you want to sign out?</p>
              <div class="modal-actions">
                  <button class="btn-cancel" id="modalCancel">Cancel</button>
                  <button class="btn-confirm" id="modalConfirm">Sign Out</button>
              </div>
          </div>
      </div>
  </div>

  <!-- Password Change OTP Modal (reused/adapted from dashboard) -->
  <div class="modal-overlay password-change-modal" id="passwordChangeModal" style="display: none;">
      <div class="modal-content" style="max-width: 400px; text-align: center;">
          <button class="modal-close" id="passwordChangeModalCloseBtn">
              <span class="material-symbols-outlined">close</span>
          </button>
          
          <div class="modal-header">
              <h2>Password Change Confirmation</h2>
              <p>Enter the OTP sent to <span style="font-weight: 600;" id="otpEmailDisplay"></span><br>to confirm your password change.</p>
          </div>
          
          <div class="otp-container" style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
              <input type="text" class="otp-input" maxlength="1" style="width: 60px; height: 60px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; font-size: 1.5rem; font-weight: 600;">
              <input type="text" class="otp-input" maxlength="1" style="width: 60px; height: 60px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; font-size: 1.5rem; font-weight: 600;">
              <input type="text" class="otp-input" maxlength="1" style="width: 60px; height: 60px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; font-size: 1.5rem; font-weight: 600;">
              <input type="text" class="otp-input" maxlength="1" style="width: 60px; height: 60px; border: 2px solid #e5e7eb; border-radius: 12px; text-align: center; font-size: 1.5rem; font-weight: 600;">
          </div>
          
          <div class="error-message" id="passwordChangeError" style="color: #ef4444; font-size: 0.85rem; margin-bottom: 10px; display: none;"></div>
          
          <button class="confirm-btn" id="confirmPasswordChangeOTPBtn" style="width: 100%; background: #dc2626; color: white; border: none; padding: 16px; border-radius: 100px; font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-bottom: 20px;">Confirm</button>
          <button class="resend-otp-btn" id="resendPasswordChangeOTPBtn" style="background: none; border: none; color: #dc2626; font-size: 0.9rem; cursor: pointer; margin-top: 10px;">Resend OTP</button>
      </div>
  </div>

  <!-- Delete Account Confirmation Modal -->
  <div class="modal-overlay" id="deleteAccountModalOverlay" style="display: none;">
      <div class="modal">
          <div class="modal-content">
              <h3>Confirm Account Deletion</h3>
              <p>Are you absolutely sure you want to delete your account? This action cannot be undone.</p>
              <div class="modal-actions">
                  <button class="btn-cancel" id="deleteAccountCancelBtn">Cancel</button>
                  <button class="btn-confirm btn-delete-confirm" id="deleteAccountConfirmBtn">Delete Account</button>
              </div>
          </div>
      </div>
  </div>

  <!-- Success/Error Notification (reused from dashboard) -->
  <div class="profile-success-notification" id="profileSuccessNotification">
      <div class="check-icon">✓</div>
      <span>Profile updated successfully!</span>
  </div>

  <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
</body>
</html>
